# ä»¥å¤ªåŠé’±åŒ…
## åŠ©è®°è¯
å¤§å¤šæ•°ç°ä»£åŠ å¯†è´§å¸é’±åŒ…ä»[æ¯”ç‰¹å¸æ”¹è¿›ææ¡ˆ (BIP) 39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) è¿›åŒ–è€Œæ¥ã€‚åœ¨é«˜ç»´åº¦ä¸Šï¼ŒBIP 39 å®šä¹‰äº†ä¸€ä¸ªå…¬å¼ï¼Œç”¨äº

1. åŠ©è®°å¥çš„ç”Ÿæˆ(ä¹Ÿç§°ä¸ºåŠ©è®°è¯ã€ç§å­çŸ­è¯­ã€æ¢å¤çŸ­è¯­ç­‰)
2. ä»è¯¥åŠ©è®°å¥ä¸­ç”Ÿæˆç§å­ã€‚è¯¥ç§å­ç”¨äºç”Ÿæˆæ‚¨çš„ç§é’¥å’Œå…¬é’¥

æ­¤ä¿¡æ¯å°†æ­¥éª¤åŸºæœ¬äº‹å®ä½å’Œå­—èŠ‚åŠ©è®°ç¬¦å¥å­ç”Ÿæˆçš„ï¼Œå¹¶ä»è¿™äº›è¯è¯­ç”Ÿæˆ 512 ä½çš„ç§å­ã€‚Python ä»£ç ç‰‡æ®µå°†ç”¨äºæ¼”ç¤ºæ²¿é€”çš„æ¦‚å¿µã€‚å…è´£å£°æ˜ï¼šæ­¤ä»£ç çº¯ç²¹å‡ºäºæ•™è‚²ç›®çš„è€Œç¼–å†™ï¼›è´Ÿè´£ä»»åœ°ä½¿ç”¨ç­‰ã€‚

æ³¨æ„ï¼šå¦‚æœæ‚¨æ›´å–œæ¬¢ç›´æ¥è·³åˆ°ä»£ç æˆ–è€…æƒ³åœ¨é˜…è¯»æ—¶è¿è¡Œå®ƒï¼Œå¯ä»¥åœ¨[æ­¤å¤„](https://github.com/marcgarreau/ethereum-notebooks/blob/master/bip39_bip32.ipynb)çš„ Jupyter ç¬”è®°æœ¬ä¸­æ‰¾åˆ°è¯¥å®ç°ã€‚

## ä¸ºä»€ä¹ˆæ˜¯ BIP 39ï¼ŸåŠ©è®°è¯ä¼˜åŠ¿
å› ä¸ºè¿™ä¸ªåŠ©è®°å¥
	
	indoor dish desk flag debris potato excuse depart ticket judge file exit
æ¯”ä¸‹é¢çš„åå…­è¿›åˆ¶ç§å­æ›´å®¹æ˜“è¯†åˆ«å’Œä¼ é€’

	3bd0bda567d4ea90f01e92d1921aacc5046128fd0e9bee96d070e1d606cb79225ee3e488bf6c898a857b5f980070d4d4ce937af587d4e937af587d6a37a8d48d606
è¯¥å…¬å¼æ˜¯ç¡®å®šæ€§çš„ï¼Œè¿™æ„å‘³ç€ç›¸åŒçš„åŠ©è®°è¯å°†å§‹ç»ˆäº§ç”Ÿç›¸åŒçš„ 512 ä½ç§å­ã€‚å¦‚æœæ‚¨çš„è®¾å¤‡è¢«ç›—æˆ–é’±åŒ…ä¾›åº”å•†å€’é—­ï¼Œæ‚¨åªéœ€ä½¿ç”¨éšæœºçš„ 12-24 ä¸ªå­—å°±å¯ä»¥å®Œå…¨æ¢å¤å¤šä¸ªé’±åŒ…ã€‚é’±åŒ…çš„ç¤¾äº¤æ¢å¤ä¹Ÿå˜å¾—æ›´å®¹æ˜“ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ä¸å››ä¸ªå¯ä¿¡èµ–çš„æœ‹å‹ä¸­çš„æ¯ä¸€ä¸ªåˆ†äº«ä¸‰ä¸ªè¯ã€‚

åœ¨é«˜ç»´åº¦ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›ä»ä¸€ä¸ªéšæœºæ•°å¼€å§‹å°†å…¶åˆ‡æˆæˆ‘ä»¬æƒ³è¦åœ¨åŠ©è®°å¥ä¸­ä½¿ç”¨çš„å•è¯æ•°ï¼Œç„¶åå°†æ¯ä¸ªæ•°æ®å—è½¬æ¢ä¸ºä¸€ä¸ªè‹±è¯­å•è¯ã€‚

æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸€ä»¶äº‹æ˜¯éšæœºæ•°ä¹Ÿç§°ä¸º `entropy`ã€‚BIP 39 è§„èŒƒæŒ‡å‡ºè¿™ç§ç†µåªèƒ½æœ‰å‡ ç§å¤§å°ï¼š

- 32 ä½çš„å€æ•°
- ä»‹äº 128 å’Œ 256 ä¹‹é—´ã€‚

ç†µè¶Šå¤§ï¼Œç”Ÿæˆçš„åŠ©è®°è¯å°±è¶Šå¤šï¼Œé’±åŒ…çš„å®‰å…¨æ€§å°±è¶Šé«˜ã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†é€‰æ‹©ä¸€ä¸ª 128 ä½çš„ç†µï¼Œæˆ‘ä»¬å¯ä»¥æœŸæœ›ä»ä¸­å¯¼å‡º 12 ä¸ªåŠ©è®°è¯ã€‚ä½œä¸ºå‚è€ƒï¼Œè¶…è¿‡ 128 çš„æ¯ 32 ä½å‘å¥å­æ·»åŠ ä¸‰ä¸ªåŠ©è®°è¯â€”â€”ä¸Šé™ä¸º 24 ä¸ªè¯ï¼Œä½¿ç”¨ 256 ä½éšæœºæ•°ã€‚

åœ¨ Python ä¸­ï¼Œ[os.urandom](https://docs.python.org/3/library/os.html#os.urandom) å¯ç”¨äºç”Ÿæˆå¤šä¸ªéšæœºå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥ `bitarray` åŒ…æä¾›äº†ä¸€ç§å°†è¿™äº›å­—èŠ‚è½¬æ¢ä¸ºä½çš„ä¾¿æ·æ–¹æ³•ã€‚ç¨åæˆ‘ä»¬å°†éœ€è¦è¿™ä¸¤ç§è¡¨ç¤ºã€‚

æ³¨æ„ï¼šå¦‚æœæ‚¨åœ¨å®¶ä¸­è¿›è¡Œæ“ä½œï¼Œæ‚¨å°†çœ‹åˆ°ä¸è¿™äº›ç¤ºä¾‹ä¸­æ˜¾ç¤ºçš„ç»“æœä¸åŒçš„ç»“æœã€‚æ¯•ç«Ÿæ˜¯éšæœºçš„ã€‚
æ³¨æ„: è¯¥ä»£ç ä¸å…·æœ‰å®‰å…¨æ€§ï¼Œä¸èƒ½ä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒ

	# valid_entropy_bit_sizes = [128, 160, 192, 224, 256] 
	entropy_bit_size = 128 
	entropy_bytes = os.urandom(entropy_bit_size // 8)
	print(entropy_bytes) 
	# b'Q\x83\xe1\xf4\xf1j\xac5\x16\x04<\x0bm`\xcf\x0c'
	from bitarray import bitarray 
	entropy_bits = bitarray() 
	entropy_bits.frombytes(entropy_bytes) 
	print(entropy_bits) 
	# bitarray('0101000110000011...01100111100001100')
éšæœºæ•°å®ç°ï¼`entropy_bits` å¹¶ä¸” `entropy_bytes` æ˜¯ç›¸åŒæ•°å­—çš„ä¸¤ç§è¡¨ç¤ºã€‚

æˆ‘ä»¬æœŸå¾…æœ€åæœ‰ 12 ä¸ªåŠ©è®°è¯ï¼Œå› æ­¤æˆ‘ä»¬è¦å°†æ•°æ®åˆ†æˆ 12 ç»„ã€‚ä½†æ˜¯ 128 ä½ä¸èƒ½è¢« 12 æ•´é™¤ã€‚BIP 39 å…¬å¼é€šè¿‡åœ¨ç†µçš„æœ«å°¾æ·»åŠ æ ¡éªŒå’Œæ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚

æ ¡éªŒå’Œçš„å¤§å°å–å†³äºç†µçš„å¤§å°ã€‚è¦æ‰¾åˆ°æ ¡éªŒå’Œé•¿åº¦ï¼Œè¯·å°†ç†µå¤§å°ï¼ˆä¾‹å¦‚ 128ï¼‰é™¤ä»¥ 32

	checksum_length = entropy_bit_size // 32
	print(checksum_length)
	# 4
å› æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“æ ¡éªŒå’Œçš„é•¿åº¦ä¸ºå››ä½ã€‚å“ªå››ä½ï¼Ÿç†µçš„ SHA-256 æ•£åˆ—çš„å‰å››ä¸ªï¼š

	from hashlib import sha256
	hash_bytes = sha256(entropy_bytes).digest()
	print(hash_bytes)
	# b'\xef\x88\xad\x02\x16\x7f\xa6y\xde\xa6T...'
	hash_bits = bitarray()
	hash_bits.frombytes(hash_bytes)
	print(hash_bits)
	# bitarray('111011111000100010...')
	checksum = hash_bits[:checksum_length]
	print(checksum)
	# bitarray('1110')
åœ¨è¿™ç§æƒ…å†µä¸‹çš„å‰ 4 ä½æ˜¯1110. è¯¥æ ¡éªŒå’Œè¢«é™„åŠ åˆ°çš„æœ«å°¾ `entropy_bits`ï¼Œä½¿æ€»ä½æ•°è¾¾åˆ° 132 â€” ä¸€ä¸ªæ•°å­—ï¼Œå¯å‡åŒ€åœ°åˆ†ä¸º 12 ç»„ï¼Œæ¯ç»„ 11 ä½ã€‚

	print(len(entropy_bits))
	# 128
	entropy_bits.extend(checksum)
	print(len(entropy_bits))
	# 132
11 ä½æ˜¯ BIP 39 è§„èŒƒä¸­é€‰æ‹©çš„â€œé­”æ³•æ•°â€ã€‚æ— è®ºç†µå¤§å°å¦‚ä½•ï¼Œç†µ+æ ¡éªŒå’Œéƒ½éœ€è¦å¹³å‡åˆ†æˆ 11 ä½çš„ç»„ã€‚ä¸‹é¢çš„ Python one-liner å°±æ˜¯è¿™æ ·åšçš„

	grouped_bits = tuple(entropy_bits[i * 11: (i + 1) * 11] for i in range(len(entropy_bits) // 11))
	print(grouped_bits)
	# (bitarray('01010001100'), bitarray('00011111000'), ...)
	print(len(grouped_bits))
	# 12
ä¸‹ä¸€æ­¥æ˜¯å°†æ¯ä¸ª 11 ä½ç»„è½¬æ¢ä¸ºæ•´æ•°ã€‚è¯¥ `bitarray` åŒ…æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è¾…åŠ©å‡½æ•° `ba2int`ï¼Œç”¨äºå°†ä½æ•°ç»„è½¬æ¢ä¸ºæ•´æ•°ã€‚ç»“æœæ•´æ•°çš„èŒƒå›´åº”ä»é›¶åˆ° 2047ï¼ˆå³ `ba2int(bitarray(â€˜11111111111â€™)) == 2047`ï¼‰

	from bitarray.util import ba2int
	indices = tuple(ba2int(ba) for ba in grouped_bits)
	print(indices)
	# (652, 248, 1001, 1814, 1366, 212, 704, 1084, 91, 856, 414, 206)
æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰åäºŒä¸ªæ•´æ•°ï¼Œæ¯ä¸ªæ•´æ•°ä»£è¡¨å•è¯åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå•è¯ã€‚[å•è¯åˆ—è¡¨](https://github.com/bitcoin/bips/blob/master/bip-0039/bip-0039-wordlists.md)æœ‰å¤šç§è¯­è¨€ï¼Œä½†æ¯ç§è¯­è¨€éƒ½æœ‰ 2048 ä¸ªå•è¯ã€‚

æ³¨æ„ï¼šå¦‚æœæ‚¨æ­£åœ¨å®æ–½è‡ªå·±çš„é’±åŒ…ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°åˆ¶ä½œè‡ªå·±çš„å•è¯åˆ—è¡¨ï¼Œä½†æ˜¯ä½¿ç”¨æ‚¨çš„å•è¯åˆ—è¡¨ç”Ÿæˆçš„é’±åŒ…å°†æ— æ³•ä¸å…¶ä»–ç¬¦åˆ BIP 39 çš„é’±åŒ…æä¾›å•†è¿›è¡Œäº’æ“ä½œ/æ¢å¤ã€‚

å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å‡è®¾[è‹±è¯­å•è¯åˆ—è¡¨](https://github.com/bitcoin/bips/blob/master/bip-0039/english.txt)å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åªéœ€å°†ç›¸åº”ç´¢å¼•å¤„çš„è‹±æ–‡å•è¯æ¢å‡ºå³å¯æ˜¾ç¤ºæ‚¨çš„åŠ©è®°ç¬¦

	english_word_list = ['abandon', 'ability', ..., 'zone', 'zoo']
	mnemonic_words = tuple(english_word_list[i] for i in indices)
	print(mnemonic_words)
	# ('face', 'business', 'large', 'tissue', 'print', 'box', 'fix', 'maple', 'arena', 'help', 'critic', 'border')
åŠ©è®°è¯ç”Ÿæˆï¼ğŸ’¥

è¯·æ³¨æ„ï¼Œè¿™äº›è¯åªæœ‰åœ¨äº§ç”Ÿå¯ä»¥æ´¾ç”Ÿç§é’¥å’Œå…¬é’¥çš„ç§å­æ—¶æ‰æœ‰ç”¨ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬æ‰¾åˆ°é‚£ä¸ªç§å­å¹¶æŠŠå®ƒåŒ…èµ·æ¥

## æ´¾ç”Ÿå¯†é’¥
512ä½çš„ç§å­æ˜¯ç”± `Password-Based Key Derivation` æ´¾ç”Ÿçš„ï¼Œå¹¶ä¸”å…·ä½“åœ°ï¼Œ[PBKDF2](https://en.wikipedia.org/wiki/PBKDF2)ã€‚è¯¥å‡½æ•°çš„è¾“å…¥æ˜¯[ä¼ªéšæœºå‡½æ•°](https://en.wikipedia.org/wiki/Pseudorandom_function_family)(HMAC-SHA512)ã€å¯†ç ï¼ˆæˆ‘ä»¬çš„åŠ©è®°è¯ï¼‰ã€salt ä»¥åŠå“ˆå¸Œå‡½æ•°å°†è¿è¡Œçš„è¿­ä»£æ¬¡æ•° (2048)ã€‚

æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠçš„å”¯ä¸€å‚æ•°æ˜¯ [salt](https://en.wikipedia.org/wiki/Salt_(cryptography))ã€‚è¿™æ˜¯ä¸ºæ‚¨çš„é’±åŒ…å¢åŠ é¢å¤–å®‰å…¨çº§åˆ«çš„æœºä¼šã€‚ä¸ºäº†ç”Ÿæˆç›ï¼Œå­—ç¬¦ä¸² `mnemonic` ä¸æ‚¨é€‰æ‹©çš„å¯é€‰å¯†ç è¿æ¥åœ¨ä¸€èµ·ã€‚å¦‚æœæ‚¨ä¸æä¾›å¯†ç ï¼Œåˆ™å¯†ç å°†é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

	passphrase = "you-make-this-up"
	salt = "mnemonic" + passphrase

è¿™å°±æ˜¯æˆ‘ä»¬è·å¾—ç§å­æ‰€éœ€çš„ä¸€åˆ‡ã€‚åœ¨ Python-land ä¸­ï¼Œ`hashlib` çš„ [pbkdf2_hmac](https://docs.python.org/3/library/hashlib.html#hashlib.pbkdf2_hmac) å‡½æ•°å°±æ˜¯æˆ‘ä»¬è¦å¯»æ‰¾çš„å‡½æ•°ã€‚æ³¨æ„åŠ©è®°å¥éœ€è¦æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼Œå•è¯ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚ç„¶åï¼ŒåŠ©è®°ç¬¦å’Œç›éƒ½éœ€è¦[è½¬æ¢](https://docs.python.org/3/library/stdtypes.html?highlight=encode#str.encode)ä¸ºå­—èŠ‚ã€‚

	mnemonic_string = ' '.join(mnemonic_words)
	print(mnemonic_string)
	# 'across abstract shine ... uphold already club'
	seed = hashlib.pbkdf2_hmac(
	   "sha512", 
	   mnemonic_string.encode("utf-8"), 
	   salt.encode("utf-8"), 
	   2048
	)
	print(seed)
	# b'\xcd@\xd0}\xbc\x17\xd6H\x00\x1c\xdc...'
	print(len(seed))
	# 64
	print(seed.hex())
	# cd40d07dbc17d648001cdc84473be584...
ç§å­ä½œä¸ºä¸€ç»„ 64 å­—èŠ‚ï¼ˆ512 ä½ï¼‰è¿”å›ï¼Œä½†åå…­è¿›åˆ¶æ ¼å¼æ˜¯æ‚¨é€šå¸¸çœ‹åˆ°çš„è¡¨ç¤ºæ–¹å¼ã€‚å¦‚æœæ‚¨åœ¨å®¶ä¸­è¿›è¡Œç¼–ç ï¼Œæ£€æŸ¥æ‚¨çš„å·¥ä½œçš„ä¸€ç§å¿«é€Ÿæ–¹æ³•æ˜¯å°†æ‚¨ç”Ÿæˆçš„åŠ©è®°è¯æ’å…¥[BIP 39åŠ©è®°è¯è½¬æ¢å™¨](https://iancoleman.io/bip39/#english)ï¼Œç„¶åæŸ¥çœ‹ç”Ÿæˆçš„ç§å­æ˜¯å¦ä¸æ‚¨çš„åŒ¹é…ã€‚

## BIP é’±åŒ…æ ‡å‡†
ä¸‰ä¸ª BIPï¼š

- [BIP 39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)
	
	 â€œç”¨äºç”Ÿæˆç¡®å®šæ€§å¯†é’¥çš„åŠ©è®°ç¬¦ä»£ç â€
- [BIP 32](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki)

	â€œåˆ†å±‚ç¡®å®šæ€§é’±åŒ…â€
- [BIP 44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki)

	â€œç¡®å®šæ€§é’±åŒ…çš„å¤šè´¦æˆ·å±‚æ¬¡ç»“æ„â€

## BIP32
BIP 32 æ˜¯ç”¨äºåˆ›å»ºåˆ†å±‚ç¡®å®šæ€§(HD) é’±åŒ…çš„è§„èŒƒã€‚è¿™æŒ‡çš„æ˜¯ 

- 1) æ‰€æœ‰å¸æˆ·éƒ½æºè‡ªä¸€ä¸ªæ ¹å¯†é’¥ ( hierarchical ) 
- 2) ç»™å®šè¯¥æ ¹å¯†é’¥ï¼Œæ‰€æœ‰å­å¸æˆ·éƒ½å¯ä»¥å¯é åœ°é‡æ–°è®¡ç®—ï¼ˆç¡®å®šæ€§ï¼‰

HD é’±åŒ…çš„åˆ†å±‚æ€§è´¨åœ¨è§†è§‰ä¸Šå¾ˆå®¹æ˜“ç†è§£ã€‚å½“æ¯ä¸ªâ€œçˆ¶â€é”®å¯ä»¥äº§ç”Ÿå¤šä¸ªâ€œå­â€é”®æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªæ ‘ç»“æ„ï¼š

![](./pic/wallet15.png)

æ‚¨ä¼šåœ¨å›¾ä¸­æ³¨æ„åˆ°å¸æˆ·æ ‘æœ‰å››ä¸ªæ·±åº¦ã€‚æ¯ä¸ªæ·±åº¦éƒ½æœ‰ä¸€äº›éšå«çš„å«ä¹‰ã€‚äº‹å®è¯æ˜ï¼Œè¿™äº›å«ä¹‰ä¹Ÿå€¼å¾—æ ‡å‡†åŒ–ï¼Œè¿™å¯¼è‡´äº† [BIP 44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) çš„åˆ›å»ºã€‚è¯¥æ ‡å‡†åœ¨å¯†é’¥çš„æ´¾ç”Ÿæ–¹å¼ä¸­èµ·ç€é‡è¦ä½œç”¨ï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨å°†å¿«é€Ÿä»‹ç»å®ƒã€‚

æˆ‘ä»¬å°†ä»ä¸€ä¸ªç§å­å¼€å§‹ï¼Œæ´¾ç”Ÿæ ¹å¯†é’¥ï¼Œç„¶åæ˜¯ä¸€äº›å­å¯†é’¥ï¼Œç›´åˆ°æˆ‘ä»¬åˆ°è¾¾æ‰€éœ€çš„åœ°å€ã€‚

## BIP44
BIP 44 ç¼–ç äº†æ¯ä¸ªæ·±åº¦çº§åˆ«çš„ç›®çš„ï¼š

	m/purposeâ€™/coin_typeâ€™/accountâ€™/change/address_index
è¯¥è§„èŒƒå¾ˆçµæ´»ï¼Œä½†ä¸“ä¸ºæ¯”ç‰¹å¸åˆ›å»ºã€‚æ¯ä¸ªçº§åˆ«éƒ½ä¸èƒ½å®Œç¾åœ°æ˜ å°„åˆ°ä»¥å¤ªåŠ,ä¾‹å¦‚ `change` ï¼Œæ·±åº¦ä»…é€‚ç”¨äºæ¯”ç‰¹å¸çš„ [UTXO](https://en.wikipedia.org/wiki/Unspent_transaction_output) æ¨¡å‹,ä½†â€œè¶³å¤Ÿå¥½â€çš„æ ‡å‡†é€šå¸¸æ€»æ¯”æ²¡æœ‰å¥½ã€‚ä¸ BIP 32 ä¸€æ ·ï¼ŒBIP 44 å·²è¢«å¹¿æ³›çš„åŒºå—é“¾é‡‡ç”¨ï¼ŒåŒ…æ‹¬ä»¥å¤ªåŠã€‚

åœ¨ä½¿ç”¨ä»¥å¤ªåŠç¡¬ä»¶æˆ–è½¯ä»¶é’±åŒ…æ—¶ï¼Œæ‚¨å¯èƒ½å·²ç»çœ‹åˆ°è¿‡ BIP 44 è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œåœ¨ [MyCrypto](https://mycrypto.com/account) åº”ç”¨ç¨‹åºä¸­è§£é”é’±åŒ…æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š

![](./pic/wallet16.png)

æ³¨æ„ä¸Šé¢å›¾ç‰‡çš„åœ°å€åœ¨æ©™è‰²å¤„

é»˜è®¤æƒ…å†µä¸‹ï¼Œä»¥å¤ªåŠçš„å¤§å¤šæ•°ç”¨æˆ·éƒ½ä½¿ç”¨æ´¾ç”Ÿåœ°å€è·¯å¾„ä¸º `m/44'/60'/0'/0/0`ã€‚

ç®€è¦è¯´æ˜ï¼š

- æ’‡å·ï¼ˆä¾‹å¦‚ï¼Œåœ¨å‰ä¸‰ä¸ªçº§åˆ«ä¸­ï¼‰è¡¨ç¤ºè¯¥å€¼å·²ç¡¬åŒ–ã€‚è¿™æ˜¯ä¸€é¡¹å®‰å…¨åŠŸèƒ½ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šäº†è§£å…¶å«ä¹‰ã€‚
- `m`

	æ˜¯çº¦å®šä¿—æˆçš„ï¼›è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¯è§£è¯»çš„ã€‚
- `44`

	`purpose` è¿™æ¡è·¯å¾„éµå¾ª `BIP 44` æ ‡å‡†,å¦‚æœæœ‰å…¶ä»–æ ‡å‡†å°±éœ€è¦ä¿®æ”¹ï¼Œå½“å‰ä»…44é€šç”¨
- `60`

	`coin_type` åŠ å¯†å¸ç±»å‹ï¼Œ60 è¡¨ç¤ºä»¥å¤ªåŠç½‘ç»œã€‚å¯åœ¨[æ­¤å¤„](https://github.com/satoshilabs/slips/blob/master/slip-0044.md)æ‰¾åˆ°â€œæ³¨å†Œç¡¬å¸ç±»å‹â€åˆ—è¡¨ã€‚
- `0`

	`account` æ„åœ¨ä»£è¡¨ä¸åŒç±»å‹çš„é’±åŒ…ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œä¸€å®¶ä¼ä¸šå¯èƒ½æœ‰ä¸€ä¸ªä¼šè®¡éƒ¨é—¨çš„å¸æˆ·åˆ†æ”¯å’Œä¸€ä¸ªé”€å”®å›¢é˜Ÿçš„å¸æˆ·åˆ†æ”¯ã€‚è¿™æ˜¯ä¸€ä¸ªä»é›¶å¼€å§‹çš„ç´¢å¼•ã€‚
- `0`

	`change` ä¸»è¦æ˜¯æ¯”ç‰¹å¸çš„[ç‰¹æ®Šä½¿ç”¨](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#change)ã€‚é€šå¸¸ä¿ç•™`0` ç”¨äºä»¥å¤ªåŠåœ°å€ã€‚
- `0`

	`address_index` æœ€åä¸€ä¸ªè·¯å¾„ï¼Œæ‚¨æ­£åœ¨ä½¿ç”¨çš„å¸æˆ·çš„ç´¢å¼•ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªä»é›¶å¼€å§‹çš„ç´¢å¼•ï¼Œæ‰€ä»¥ç´¢å¼• `0` æ˜¯ç¬¬ä¸€ä¸ªå¯ç”¨çš„å¸æˆ·ã€‚å¦‚æœä½ æœ‰åä¸ªè´¦æˆ·ï¼Œæœ€åä¸€ä¸ªçš„æ´¾ç”Ÿè·¯å¾„æ˜¯ `m/44'/60'/0'/0/9`ã€‚

BIP 32 è¦æ±‚æˆ‘ä»¬ä»ç§å­å¼€å§‹ï¼Œé€šå¸¸æ˜¯ç”± BIP 39 å®ç°äº§ç”Ÿçš„ç§å­ã€‚ä»é‚£é¢—ç§å­ä¸­ï¼Œä½ ä¼šå‘ç°ä½ å¯èƒ½éœ€è¦çš„å°½å¯èƒ½å¤šçš„è´¦æˆ·ã€‚å¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä»æ ‡å‡†æµ‹è¯•å‘é‡ä¸­æä¾›çš„ç§å­ä¹‹ä¸€å¼€å§‹ï¼š

`seed = 'fffcf9f6f3f0edeae7e4e1dedbd8d5d2cfccc9c6c3c0bdbab7b4b1aeaba8a5a29f9c999693908d8a8784817e7b7875726f6c696663605d5a5754514e4b484542'`

ç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯å°†ç§å­è½¬æ¢ä¸ºæ‰€è°“çš„ä¸»å¯†é’¥æˆ–æ ¹å¯†é’¥ã€‚â€œæ ¹â€æ˜¯è¯´æ˜æ€§çš„ï¼Œå› ä¸ºæ‰€æœ‰æ´¾ç”Ÿé”®éƒ½å°†ä»å®ƒåˆ†æ”¯å‡ºæ¥ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª[å·¥å…·](https://iancoleman.io/bip39/)è¿›è¡Œé¢„è§ˆ,çœ‹çœ‹æ‰€äº§ç”Ÿçš„æ ¹å¯†é’¥å’Œæ´¾ç”Ÿåœ°å€ã€‚ç¡®ä¿å°†ä¸Šé¢çš„ç§å­ï¼ˆä¸å¸¦å¼•å·ï¼‰ç²˜è´´åˆ° BIP 39 ç§å­å­—æ®µä¸­ï¼Œç„¶åä»ç¡¬å¸é€‰é¡¹ä¸­é€‰æ‹©â€œETH â€” Ethereumâ€ ã€‚

äº§ç”Ÿè¿™äº›å€¼çš„èƒŒåæœ‰å¾ˆå¤šäº‹æƒ…è¦åšï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ã€‚

æ³¨æ„ï¼šå³å°†æ¨å‡ºçš„å…¬å¼é€šå¸¸ä¾èµ–äºå“ˆå¸Œå‡½æ•°å’Œæ¤­åœ†æ›²çº¿åŠ å¯†ã€‚è¿™äº›æ¦‚å¿µçš„å¤æ‚æ€§è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚ç›¸åï¼Œæ‚¨ä¼šæ‰¾åˆ°ä¸€ä¸ªç«¯åˆ°ç«¯çš„å®ç°ï¼Œå…¶ä¸­åŒ…å«å¯¹å…¨å±€çš„è§£é‡Šã€‚

## æ ¹å¯†é’¥ç”Ÿæˆ
æ ¹å¯†é’¥æ˜¯é€šè¿‡[å‡ ä¸ªæ­¥éª¤](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#master-key-generation)ç”Ÿæˆçš„ï¼š

- `I=HMAC-SHA512`ï¼ˆå¯†é’¥=â€œæ¯”ç‰¹å¸ç§å­â€,æ•°æ®=ç§å­ï¼‰
- å°† `I` æ‹†åˆ†ä¸ºä¸¤ä¸ª 32 å­—èŠ‚çš„åºåˆ—ï¼Œ`L` å’Œ `R`
- ä½¿ç”¨ `parse256(L)` ä½œä¸ºä¸»å¯†é’¥ï¼Œä½¿ç”¨ R ä½œä¸ºä¸»é“¾ç 

åœ¨ Python ä¸­

	import binascii
	import hmac
	import hashlib
	# the HMAC-SHA512 `key` and `data` must be bytes:
	seed_bytes = binascii.unhexlify(seed)
	I = hmac.new(b'Bitcoin seed', seed_bytes, hashlib.sha512).digest()
	L, R = I[:32], I[32:]
	master_private_key = int.from_bytes(L, 'big')
	master_chain_code = R
å¾ˆå¥½çš„ç¬¬ä¸€æ­¥ï¼ä¸»ç§é’¥å’Œé“¾ç å°†ç”¨äºæ´¾ç”Ÿæ‰€æœ‰åç»­å­å¯†é’¥ã€‚æ‰€è¿°é“¾ç ç”¨ä½œ[ç†µ](https://en.wikipedia.org/wiki/Entropy_(computing))ã€‚

æ ¹å¯†é’¥é€šå¸¸è¡¨ç¤ºä¸ºæ‰©å±•ç§é’¥( xprv)ã€‚åœ¨ BIP 32 è§„èŒƒä¸­å®šä¹‰ï¼Œæ‰©å±•ç§é’¥æ˜¯ç§é’¥ã€é“¾ç å’Œä¸€äº›é™„åŠ å…ƒæ•°æ®çš„ Base58 ç¼–ç ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šæ¨å¯¼å‡ºæ¥ã€‚

æœ‰è¶£çš„äº‹å®ï¼š[Base58 ç¼–ç ](https://en.wikipedia.org/wiki/Base58)æ˜¯ä¸“é—¨ä¸ºæ¯”ç‰¹å¸åˆ›å»ºçš„ã€‚è¿™å°±åƒ Base64 çš„ï¼Œä½†æ²¡æœ‰ä¸€äº›å¸¸ç”¨æ›²è§£å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š0ï¼ŒOï¼ŒIï¼Œå’Œlã€‚å› æ­¤ï¼ŒäºŒè¿›åˆ¶å€¼å¯ä»¥è½¬æ¢ä¸ºä»¥ä¸‹å­—æ¯å’Œæ•°å­—

	123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz
å¦‚ä¸Šä¸€ä¸ªå¸æˆ·ç”Ÿæˆå™¨å±å¹•æˆªå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹æ‰©å±•ç§é’¥

	xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U
	
æ‚¨ä¼šæ³¨æ„åˆ°

-  1) æ²¡æœ‰é›¶ã€å¤§å†™ oã€å¤§å†™ i æˆ–å°å†™ l
-  2) å‰å››ä¸ªå­—ç¬¦æ˜¯ xprv. xprv æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„å››ä¸ªå­—èŠ‚åºåˆ—ï¼Œè®©æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æ­£åœ¨æŸ¥çœ‹æ—¨åœ¨ç”¨äºä¸»ç½‘ä¸Šçš„æ‰©å±•ç§é’¥

æ ¹æ®[è§„èŒƒ](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#serialization-format)ï¼Œ78 ä¸ªå­—èŠ‚è¢«ç¼–ç ä»¥æ´¾ç”Ÿæ‰©å±•å¯†é’¥

- 4 ä¸ªå­—èŠ‚

	ç‰ˆæœ¬å­—èŠ‚
	
	- ä¸»ç½‘ï¼š
		- `0x0488B21E`å…¬å…±
		- `0x0488ADE4`ç§æœ‰
	- æµ‹è¯•ç½‘ï¼š
		- `0x043587CF`å…¬å…±
		- `0x04358394`ç§æœ‰
- 1 ä¸ªå­—èŠ‚

	æ·±åº¦ï¼ˆ`0x00`ç”¨äºä¸»èŠ‚ç‚¹ï¼Œ`0x01`ç”¨äº 1 çº§æ´¾ç”Ÿå¯†é’¥ç­‰ï¼‰
- 4 ä¸ªå­—èŠ‚

	çˆ¶å¯†é’¥çš„æŒ‡çº¹
- 4 ä¸ªå­—èŠ‚

	å­ç¼–å·
- 32 å­—èŠ‚

	é“¾ç 
- 33 å­—èŠ‚

	å…¬é’¥æˆ–ç§é’¥æ•°æ®

åœ¨ Python ä¸­ï¼Œè¿™å¯èƒ½å¦‚ä¸‹æ‰€ç¤º

	import base58
	VERSION_BYTES = {
	    'mainnet_public': binascii.unhexlify('0488b21e'),
	    'mainnet_private': binascii.unhexlify('0488ade4'),
	    'testnet_public': binascii.unhexlify('043587cf'),
	    'testnet_private': binascii.unhexlify('04358394'),
	}
	version_bytes = VERSION_BYTES['mainnet_private']
	depth_byte = b'\x00'
	parent_fingerprint = b'\x00' * 4
	child_number_bytes = b'\x00' * 4
	key_bytes = b'\x00' + L
	all_parts = (
	    version_bytes,      # 4 bytes  
	    depth_byte,         # 1 byte
	    parent_fingerprint,  # 4 bytes
	    child_number_bytes, # 4 bytes
	    master_chain_code,  # 32 bytes
	    key_bytes,          # 33 bytes
	)
	all_bytes = b''.join(all_parts)
	root_key = base58.b58encode_check(all_bytes).decode('utf8')
	print(root_key)
	# xprv9s21ZrQH143K...T2emdEXVYsCzC2U

åœ¨æ ¹å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†é™„åŠ å…ƒæ•°æ®éƒ½è¢«æ¸…é›¶

- æˆ‘ä»¬çŸ¥é“æ ¹é”®æ˜¯æ ‘ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå³æ·±åº¦ä¸ºé›¶ï¼‰ï¼Œæ‰€ä»¥ `depth_byte` å¾ˆç›´è§‚â€”â€”ä¸€ä¸ªç©ºå­—èŠ‚ã€‚
- å½“æˆ‘ä»¬éœ€è¦ä¸ºå­å¸æˆ·è®¡ç®—æŒ‡çº¹å’Œå­ç¼–å·æ—¶ï¼Œæˆ‘ä»¬å°†å¾ˆå¿«æ¢ç´¢æŒ‡çº¹å’Œå­ç¼–å·ï¼Œä½†é¦–å…ˆï¼Œå®ƒä»¬æ¯ä¸ªéƒ½è¡¨ç¤ºä¸ºå››ä¸ªç©ºå­—èŠ‚ã€‚
- è§„èŒƒè¦æ±‚ 33 ä¸ªå­—èŠ‚ç”¨äºå…³é”®æ•°æ®ã€‚ä¸»ç§é’¥ï¼ŒLï¼Œåªæœ‰ 32ï¼Œæ‰€ä»¥å‰é¢å¡«å……äº†ä¸€ä¸ªç©ºå­—èŠ‚

å¤ªå¥½äº†ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ ¹å¯†é’¥ã€‚æˆ‘ä»¬å®é™…å¯ä»¥ä½¿ç”¨çš„å¸æˆ·æ€ä¹ˆæ ·â€”â€”å¸¦æœ‰ç§é’¥å’Œå…¬å…±åœ°å€ï¼Ÿ

åœ¨æ›´é«˜çº¬åº¦ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬æƒ³è¦çš„è·¯å¾„ä¸­çš„æ¯ä¸ªæ·±åº¦æ´¾ç”Ÿå­é”®ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¸º `path` å¤„çš„åœ°å€ç”Ÿæˆå¯†é’¥ `m/44'/60'/0'/0/0`ï¼Œæˆ‘ä»¬æœ€ç»ˆå°†è¿è¡Œå­å¯†é’¥æ´¾ç”Ÿå‡½æ•°äº”æ¬¡â€”â€”è·¯å¾„ä¸­çš„æ¯ä¸ªæ•°å€¼ä¸€æ¬¡ã€‚

åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬å°†è·¯å¾„è¡¨ç¤ºä¸ºä¸€ä¸ªå…ƒç»„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿­ä»£ä¸€äº›ä¸œè¥¿ã€‚ç›´æ¥ä» [è§„èŒƒ](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#extended-keys) ä¸­æå–

æ¯ä¸ªæ‰©å±•é”®æœ‰ 2Â³Â¹ ä¸ªæ™®é€šå­é”®å’Œ 2Â³Â¹ ä¸ªå¼ºåŒ–å­é”®ã€‚è¿™äº›å­é”®ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªç´¢å¼•ã€‚

- æ™®é€šçš„å­é”®ä½¿ç”¨ç´¢å¼• 0 åˆ° 2Â³Â¹â€“1
- å¼ºåŒ–çš„å­é”®ä½¿ç”¨ç´¢å¼• 2Â³Â¹ åˆ° 2Â³Â²â€“1

å› æ­¤ï¼Œå¦‚æœè¯¥å€¼æ˜¯ hardenedï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€å°† 2Â³Â¹ æ·»åŠ åˆ°è¯¥æ•°å­—ä¸Šã€‚ä¾‹å¦‚ï¼š

	# Break each depth into integers (m/44'/60'/0'/0/0)
	#    e.g. (44, 60, 0, 0, 0)
	# If hardened, add 2**31 to the number:
	#    e.g. (44 + 2**31, 60 + 2**31, 0 + 2**31, 0, 0)
	path_numbers = (2147483692, 2147483708, 2147483648, 0, 0)
	
ç¡¬åŒ–çš„è·¯å¾„æ„å‘³ç€ä»€ä¹ˆï¼Ÿè¿™æ˜¯ä¸€é¡¹å®‰å…¨åŠŸèƒ½ï¼›

- ç§é’¥ç”¨äºç”Ÿæˆå¼ºåŒ–å¯†é’¥
- éå¼ºåŒ–ï¼ˆæˆ–æ™®é€šï¼‰å¯†é’¥ä½¿ç”¨å…¬é’¥ç”Ÿæˆã€‚

è¿™å¯¹é”®çš„åŠŸèƒ½æœ‰å½±å“ã€‚

ä¾‹å¦‚ï¼Œæ™®é€šæ‰©å±•å…¬é’¥ ( xpub) å¯ç”¨äºåˆ›å»ºå­å…¬é’¥ã€‚ä¸€ä¸ªæ™®éå¼•ç”¨çš„ç”¨ä¾‹æ˜¯ä¸ºåº—é¢æä¾›ä¸€ä¸ªæ‰©å±•çš„å…¬é’¥ï¼Œè¯¥å…¬é’¥å¯ç”¨äºæ´¾ç”Ÿä¸€ä¸ªæ–°çš„å­å…¬å…±åœ°å€ä»¥æ¥æ”¶æ¯æ¬¡é”€å”®çš„èµ„é‡‘ã€‚æœåŠ¡å™¨ä¸Šæ°¸è¿œæ²¡æœ‰ç§é’¥ï¼Œå› æ­¤å¦‚æœæœåŠ¡å™¨å—åˆ°å¨èƒï¼Œå®ƒä»¬å°±ä¸ä¼šæœ‰æ³„éœ²çš„é£é™©ã€‚

å¦‚æœæ‚¨æƒ³æ·±å…¥äº†è§£,[ç‚¹å‡»è¿™é‡Œ](https://bitcoin.stackexchange.com/a/37489)ã€‚
	
ä¸ºäº†å¯¼å‡ºæ‰©å±•çš„å­ç§é’¥ï¼Œæˆ‘ä»¬éœ€è¦ç”¨äºå¯¼å‡ºæ ¹å¯†é’¥çš„ç›¸åŒå˜é‡ï¼š

- ç§é’¥
- é“¾ç 
- æŒ‡çº¹
- æ·±åº¦
- å­ç¼–å·

ç›®å‰ï¼Œæˆ‘ä»¬åªå¯¼å‡ºäº†æ ¹å¯†é’¥åŠå…¶ç»„æˆéƒ¨åˆ†ï¼Œå‰©ä¸‹ï¼š

	depth = 0
	parent_fingerprint = None
	child_number = None
	private_key = master_private_key
	chain_code = master_chain_code
æˆ‘ä»¬å·²ç»è®¨è®ºäº†æ·±åº¦ã€ç§é’¥å’Œé“¾ç ã€‚`child_number` æ˜¯ç®€å•åœ°ä»å½“å‰è·¯å¾„æ•´æ•° `path_numbers` å…ƒç»„ã€‚ç¬¬ä¸€æ¬¡é€šè¿‡å­é”®æ¨å¯¼å‡½æ•°ï¼Œ`child_number` å°†ç­‰äº 2147483692ã€‚åœ¨ç¬¬äº”æ¬¡ä¹Ÿæ˜¯æœ€åä¸€æ¬¡è¿­ä»£ä¸­ï¼Œ`child_number` å°†æ˜¯ 0ã€‚

æŒ‡çº¹æ¶‰åŠæ›´å¤šã€‚æ ¹æ® [BIP 32 æ ‡å‡†](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#key-identifiers)

æ‰©å±•å¯†é’¥å¯ä»¥é€šè¿‡åºåˆ—åŒ–çš„ ECDSA å…¬é’¥ K çš„ Hash160ï¼ˆSHA256 ä¹‹åçš„ RIPEMD160ï¼‰æ¥è¯†åˆ«ï¼Œå¿½ç•¥é“¾ç ã€‚[â€¦] æ ‡è¯†ç¬¦çš„å‰ 32 ä½ç§°ä¸ºå¯†é’¥æŒ‡çº¹ã€‚[...] è¯·æ³¨æ„ï¼Œçˆ¶èŠ‚ç‚¹çš„æŒ‡çº¹ä»…ç”¨ä½œåœ¨è½¯ä»¶ä¸­æ£€æµ‹çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„å¿«é€Ÿæ–¹æ³•......

æ€»ä¹‹ï¼ŒæŒ‡çº¹æ˜¯ä»å­å¯†é’¥åˆ°å…¶çˆ¶å¯†é’¥çš„é“¾æ¥ï¼ŒBIP 32 æ ‡å‡†æŒ‡å®šäº†æ´¾ç”Ÿè¿™å››ä¸ªå­—èŠ‚çš„å…¬å¼ã€‚

è¯¥å…¬å¼æ˜¯æ•£åˆ—å‡½æ•°å’Œæ¤­åœ†æ›²çº¿å¯†ç æœ¯çš„æ··åˆä½“ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯æƒ³æŠŠè¿™ä¸ªé­”æ³•æ”¶èµ·æ¥ï¼š

	from ecdsa import SECP256k1
	from ecdsa.ecdsa import Public_key
	SECP256k1_GEN = SECP256k1.generator
	def serialize_curve_point(p):
	   x, y = K.x(), K.y()
	   if y & 1:
	      return b'\x03' + x.to_bytes(32, 'big')
	   else:
	      return b'\x02' + x.to_bytes(32, 'big')
	def curve_point_from_int(k):
	   return Public_key(SECP256k1_GEN, SECP256k1_GEN * k).point
	def fingerprint_from_private_key(k):
	   K = curve_point_from_int(k)
	   K_compressed = serialize_curve_point(K)
	   identifier = hashlib.new(
	      'ripemd160',
	      hashlib.sha256(K_compressed).digest(),
	   ).digest()
	   return identifier[:4]
æœ€åï¼Œè®©æˆ‘ä»¬è§£å†³æˆ‘ä»¬æœŸæœ›è¿è¡Œäº”æ¬¡çš„å­å¯†é’¥æ´¾ç”Ÿå‡½æ•°ã€‚è¯¥å‡½æ•°å°†ç§é’¥ã€é“¾ç å’Œå­é“¾ç ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›å­ç§é’¥å’Œå­é“¾ç ã€‚

è¯¥å‡½æ•°æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ£€æŸ¥å®ƒæ˜¯å¦ä¼šæ´¾ç”Ÿå‡ºå¼ºåŒ–å¯†é’¥æˆ–æ™®é€šå¯†é’¥ã€‚è¯·è®°ä½ï¼Œåœ¨å‰é¢çš„è®¨è®ºä¸­ï¼Œç§é’¥ç”¨äºæ´¾ç”Ÿå¼ºåŒ–å¯†é’¥ï¼Œè€Œå…¬é’¥ï¼ˆä¾‹å¦‚ï¼Œ`curve_point_from_int(private_key)`ï¼‰æ´¾ç”Ÿæ™®é€šå¯†é’¥ã€‚

è¯¥å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†åº”è¯¥ç±»ä¼¼äºä¸»ç§é’¥å’Œä¸»é“¾ä»£ç çš„æ¨å¯¼ï¼š

	# Review of master private key and chain code derivation:
	I = hmac.new(b'Bitcoin seed', seed_bytes, hashlib.sha512).digest()
	L, R = I[:32], I[32:]
	master_private_key = int.from_bytes(L, 'big')
	master_chain_code = R
è¿™ä¸€æ¬¡ï¼Œä½¿ç”¨çˆ¶é“¾ç ä»£æ›¿ï¼Œb'Bitcoin seed'æ•°æ®æ˜¯é™„åŠ åˆ°ï¼ˆç¡¬åŒ–æˆ–æ­£å¸¸ï¼‰å…³é”®æ•°æ®çš„å­ç¼–å·ï¼š

	SECP256k1_ORD = SECP256k1.order
	def derive_ext_private_key(private_key, chain_code, child_number):
	    if child_number >= 2 ** 31:
	        # Generate a hardened key
	        data = b'\x00' + private_key.to_bytes(32, 'big')
	    else:
	        # Generate a non-hardened key
	        p = curve_point_from_int(private_key)
	        data = serialize_curve_point(p)
	    data += child_number.to_bytes(4, 'big')
	    hmac_bytes = hmac.new(chain_code, data, hashlib.sha512).digest()
	    L, R = hmac_bytes[:32], hmac_bytes[32:]
	    L_as_int = int.from_bytes(L, 'big')
	    child_private_key = (L_as_int + private_key) % SECP256k1_ORD
	    child_chain_code = R
	    return (child_private_key, child_chain_code)
ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ‰€æœ‰çš„éƒ¨åˆ†ï¼Œæ˜¯æ—¶å€™è¿­ä»£è·¯å¾„å·å¹¶é€’å½’æ›´æ–°æ¯ä¸ªå€¼äº†ï¼š

	path_numbers = (2147483692, 2147483708, 2147483648, 0, 0)
	depth = 0
	parent_fingerprint = None
	child_number = None
	private_key = master_private_key
	chain_code = master_chain_code
	for i in path_numbers:
	   depth += 1
	   child_number = i
	   parent_fingerprint = fingerprint_from_private_key(private_key)
	   private_key, chain_code = derive_ext_child_key(private_key)
å®Œæˆåï¼Œæ‚¨å°†è·å¾—è·¯å¾„ä¸­å¸æˆ·çš„ç§é’¥ `m/44'/60'/0'/0/0`å›°éš¾çš„éƒ¨åˆ†å·²ç»å®Œæˆã€‚æ‚¨å¯ä»¥é€šè¿‡æ˜¾ç¤ºç§é’¥çš„åå…­è¿›åˆ¶å€¼å°†æ‚¨çš„ç»“æœä¸ `Ian Coleman` ç”Ÿæˆå™¨ä¸­çš„ç»“æœè¿›è¡Œæ¯”è¾ƒ

	print(f'private key: {hex(private_key)}')
	# private key: 0x3c4cf049f83a5870ab31c396a0d46783c3e3974da1364ea5a2477548d36b5f8f
å…¬é’¥å¯ä»¥ä»ç§é’¥æ´¾ç”Ÿå‡ºæ›´å¤šçš„æ¤­åœ†æ›²çº¿å¯†ç 

	p = curve_point_from_int(private_key)
	public_key_bytes = serialize_curve_point(p)
	print(f'public key: 0x{public_key_bytes.hex()}')
	# public key: 0x024c8f4044470bd42b81a8b233e2f954b63f4ee2c32c8d44288b44188754e2042e
å¦‚æœæˆ‘ä»¬æƒ³æ”¶åˆ°ä»»ä½•èµ„é‡‘ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªå…¬å…±åœ°å€ã€‚åœ°å€æ˜¯ä»å…¬é’¥æ´¾ç”Ÿå‡ºæ¥çš„ã€‚å…·ä½“æ¥è¯´ï¼Œå…¬å…±åœ°å€æ˜¯å…¬é’¥ç‚¹çš„ Keccak-256 å“ˆå¸Œçš„æœ€å 20 ä¸ªå­—èŠ‚ã€‚åœ¨ Python ä¸­ï¼š

	from eth_utils import keccak
	digest = keccak(x.to_bytes(32, 'big') + y.to_bytes(32, 'big'))
	address = '0x' + digest[-20:].hex()
	print(f'public address: {address}')
	# public address: 0xbbec2620cb01adae3f96e1fa39f997f06bfb7ca0

## HD é’±åŒ…
è®©æˆ‘ä»¬é€šè¿‡åœ¨æ­¤è·¯å¾„ä¸Šä¸ºå¸æˆ·æ´¾ç”Ÿæ‰©å±•ç§é’¥( `xprv` ) ã€‚å¯¼å‡ºæ­¤å€¼æ˜¯äº†è§£æ‚¨æ˜¯å¦æ­£ç¡®å®Œæˆæ•´ä¸ªè¿‡ç¨‹çš„æœ€ä½³æ–¹å¼ã€‚æ‰€è¿° BIP 32 æ ‡å‡†åŒ…æ‹¬ä¸€äº›[æµ‹è¯•çŸ¢é‡](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#test-vectors)ä¸ºHDé’±åŒ…å¼€å‘äººå‘˜æ¥éªŒè¯ï¼Œç»™å®šç§å­å’ŒæœŸæœ›çš„è·¯å¾„ï¼Œå®ƒä»¬çš„è½¯ä»¶å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ `xprv` å’Œ `xpub` å€¼ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ä¸å¯¼å‡ºæ ¹å¯†é’¥ç›¸åŒçš„å…¬å¼ï¼Œä½†è¿™æ¬¡å…ƒæ•°æ®åŒ…å«çš„ä¸ä»…ä»…æ˜¯ç©ºå­—èŠ‚ï¼š

	version_bytes = VERSION_BYTES['mainnet_private'] 
	depth_byte = depth.to_bytes(1, 'big') 
	child_number_bytes = child_number.to_bytes(4, 'big') 
	key_bytes = b'\x00' + private_key.to_bytes(32, 'big')
	all_parts = ( 
	    version_bytes, # 4 bytes   
	    depth_byte, # 1 byte 
	    parent_fingerprint, # 4 bytes 
	    child_number_bytes, # 4 bytes 
	    chain_code, # 32 bytes 
	    key_bytes, # 33 bytes 
	) 
	all_bytes = b''.join(all_parts) 
	extended_private_key = base58.b58encode all_bytes).decode('utf8')
ä½ åº”è¯¥å¾—åˆ°ä»¥ä¸‹ç»“æœxprv

	print(f'extended private key: {extended_private_key}') 
	# æ‰©å±•ç§é’¥ï¼šxprvA2vDkmMuK1Ae2eF92xyQpn6qZzHoGTnV5hXrBw7UExUTXeMFTZDLF7cRD6vhR785RMF2EC6mAo3ojRxSVGogsvCEUGXUS	

è¿˜æœ‰å¾ˆå¤šä¸œè¥¿è¦æ¢ç´¢,æˆ‘ä»¬æ²¡æœ‰æ´¾ç”Ÿå‡ºä»»ä½•æ‰©å±•çš„å…¬é’¥ ( xpub) æˆ–æ·±å…¥ç ”ç©¶å¼ºåŒ–å¯†é’¥

åŒæ ·ï¼Œå¦‚æœæ‚¨å¯¹å¸¦æœ‰æ­¤ä»£ç çš„ Jupyter Notebook æ„Ÿå…´è¶£ï¼Œå¯ä»¥åœ¨[æ­¤å¤„](https://github.com/marcgarreau/ethereum-notebooks/blob/master/bip32.ipynb)æ‰¾åˆ°ã€‚å¦‚æœä½ æƒ³æ¢ç´¢ä¸€ä¸ªå…¨é¢çš„ Python å®ç°ï¼Œ[py-hdwallet](https://github.com/ethereum/py-hdwallet/)æ˜¯ä¸€ä¸ªç”±ä»¥å¤ªåŠåŸºé‡‘ä¼šç»´æŠ¤çš„æ–°é¡¹ç›®ã€‚è¿™ç¯‡æ–‡ç« ä¸­çš„ä»£ç æ˜¯ py-hdwallet ä¸­çš„ç®€åŒ–ç‰ˆæœ¬ã€‚


## BIP32 ä¸¤ç§æ´¾ç”Ÿç±»å‹ï¼Œéç¡¬åŒ–(æ™®é€š)å¯†é’¥-non-hardened keys å’Œç¡¬åŒ–å­å¯†é’¥Hardened keys çš„åŒºåˆ«
æœ¬è´¨ä¸Šï¼Œç¡¬åŒ–çš„å­é”®æ˜¯ç”¨ `hash(parent private key + index)` è®¡ç®—çš„ï¼Œè€Œéç¡¬åŒ–çš„å­é”®æ˜¯ç”¨ `hash(parent public key + index)` è®¡ç®—çš„ã€‚

é‚£ä¹ˆè¿™æœ‰ä»€ä¹ˆå®é™…åæœå‘¢ï¼Ÿ

- ä½¿ç”¨æ‰©å±•å…¬é’¥æ´¾ç”Ÿéå¼ºåŒ–çš„å­å…¬é’¥

	è¿™åœ¨æ‚¨æƒ³æ¥å—ä»˜æ¬¾ä½†ä¸èƒ½ç«‹å³æ¶ˆè´¹çš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªé”€å”®ç¾Šé©¼æ¯›è¢œå­çš„ç½‘ç«™ï¼Œæ‚¨çš„æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨æ‰©å±•çš„å…¬é’¥æ¥æ¥å—ä»˜æ¬¾ï¼Œå¦‚æœè¢«é»‘å®¢å…¥ä¾µï¼Œæ‚¨ä¹Ÿä¸ä¼šæŸå¤±æ‰€æœ‰èµ„é‡‘ã€‚æ‰€ä»¥è¿™å°±æ˜¯æ‚¨å¯èƒ½ä½¿ç”¨éå¼ºåŒ–æ´¾ç”Ÿçš„åŸå› ã€‚
- ä½¿ç”¨æ‰©å±•ç§é’¥æ´¾ç”Ÿå‡ºå¼ºåŒ–å¯†é’¥

	å½“æ”»å‡»è€…æ‹¥æœ‰ 
	
	- 1) æ‰©å±•å…¬é’¥
	- 2) ä»ä¸­æ´¾ç”Ÿå‡ºçš„éå¼ºåŒ–ç§é’¥ä¹‹ä¸€æ—¶ï¼Œéå¼ºåŒ–å…¬é’¥è¾ƒå¼±ã€‚

	åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥è®¡ç®—å‡ºæ‰©å±•å…¬é’¥çš„ç§é’¥ï¼Œä»è€Œè·å¾—å¯ä»¥ä»ä¸­æ´¾ç”Ÿå‡ºçš„æ¯ä¸ªå¯†é’¥ï¼Œæ— è®ºæ˜¯å¼ºåŒ–çš„è¿˜æ˜¯éå¼ºåŒ–çš„ã€‚

é‚£ä¹ˆä½ çš„åº”ç”¨é»˜è®¤åº”è¯¥ä½¿ç”¨ä»€ä¹ˆï¼Ÿ

æ‚¨åº”è¯¥ä½¿ç”¨éå¼ºåŒ–å¯†é’¥ï¼Œå¹¶ç¦ç”¨å¯¼å‡ºç§é’¥çš„åŠŸèƒ½ï¼Œå› ä¸ºè¿™ä¼šå…è®¸æ”»å‡»è€…ç ´åé’±åŒ…ä¸­çš„å…¶ä»–å¯†é’¥ã€‚å³ä½¿æ”»å‡»è€…è·å¾—äº†å…¶ä¸­ä¸€ä¸ªç§é’¥ï¼Œåœ¨æ”»å‡»è€…æ— æ³•è®¿é—®æ‰©å±•å…¬é’¥çš„æƒ…å†µä¸‹ï¼Œéå¼ºåŒ–ç­‰åŒäºå¼ºåŒ–å®‰å…¨æ€§ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œéå¼ºåŒ–å¯†é’¥çš„åŠŸèƒ½èƒœè¿‡å¼ºåŒ–å¯†é’¥å¢åŠ çš„å®‰å…¨æ€§ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸éœ€è¦éå¼ºåŒ–å¯†é’¥çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä½¿ç”¨å¼ºåŒ–å¯†é’¥ï¼Œå› ä¸ºå®ƒä»¬æ›´å®‰å…¨ã€‚

## å¼ºåŒ–å­å¯†é’¥ä¼˜ç‚¹
- å½“æ‚¨ä¸éœ€è¦å‘æŸäººæä¾›ä¸»å…¬é’¥å¹¶è®©ä»–ä»¬çŸ¥é“æ‰€æœ‰åœ°å€çš„èƒ½åŠ›æ—¶ï¼Œå¼ºåŒ–å¯†é’¥å¾ˆæœ‰ç”¨ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œå®ƒä»¬æ¯”æœªå¼ºåŒ–çš„å…·æœ‰æ›´å¥½çš„å®‰å…¨ç‰¹æ€§ã€‚

## éå¼ºåŒ–(æ™®é€š)å­å¯†é’¥ä¼˜ç‚¹
- ä½¿ç”¨å¼ºåŒ–åœ°å€ï¼Œæˆ‘éœ€è¦æ­¤æœåŠ¡çš„ç§é’¥ï¼Œå› æ­¤å¦‚æœæˆ‘è¢«é»‘å®¢å…¥ä¾µï¼Œæˆ‘å°†æŸå¤±æ‰€æœ‰èµ„é‡‘ã€‚ä½¿ç”¨éå¼ºåŒ–åœ°å€ï¼Œæˆ‘çš„æœåŠ¡æ²¡æœ‰æ•æ„Ÿä¿¡æ¯ï¼Œå› æ­¤å®ƒå¯ä»¥è¢«é»‘å®¢å…¥ä¾µè€Œä¸ä¼šé€ æˆæŸå®³ã€‚æˆ‘åªéœ€è¦å°†ç§é’¥å®‰å…¨åœ°å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ã€‚
	
## å‚è€ƒ
- [BIP 39åŠ©è®°è¯è½¬æ¢å™¨](https://iancoleman.io/bip39/#english)
- [Ethereum 201: Mnemonics](https://wolovim.medium.com/ethereum-201-mnemonics-bb01a9108c38)
- [Ethereum 201: HD Wallets](https://wolovim.medium.com/ethereum-201-hd-wallets-11d0c93c87f7)
- [BIP32 ä¸­çš„å­å¯†é’¥å’Œç¡¬åŒ–å­å¯†é’¥æœ‰ä»€ä¹ˆåŒºåˆ«](https://bitcoin.stackexchange.com/questions/37488/eli5-whats-the-difference-between-a-child-key-and-a-hardened-child-key-in-bip3/37489#37489)